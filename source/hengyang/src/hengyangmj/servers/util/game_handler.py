# -*- coding=utf-8 -*-'''Created on 2015年9月28日@author: liaoxx'''from difang.majiang2.servers.util.game_handler import GameTcpHandlerfrom freetime.entity.msg import MsgPackfrom poker.protocol import router, runcmdfrom poker.protocol.decorator import markCmdActionHandler, markCmdActionMethod@markCmdActionHandlerclass QuJingGameTcpHandler(GameTcpHandler):    def __init__(self):        super(QuJingGameTcpHandler, self).__init__()    @markCmdActionMethod(cmd='game', action="quick_start", clientIdVer=0, scope='game', lockParamName="")    def doGameQuickStart(self, userId, gameId, clientId, roomId0, tableId0, playMode, sessionIndex):        super(QuJingGameTcpHandler, self).doGameQuickStart(userId, gameId, clientId, roomId0, tableId0, playMode,                                                           sessionIndex)    @markCmdActionMethod(cmd='game', action="award_certificate", clientIdVer=0, scope='game', lockParamName="")    def doAwardCertificate(self, userId, gameId, match_id, clientId):        super(QuJingGameTcpHandler, self).doAwardCertificate(userId, gameId, match_id, clientId)    @markCmdActionMethod(cmd='game', action="create_table_info", clientIdVer=0, scope='game', lockParamName="")    def doGetCreatTableInfo(self, userId, gameId, clientId):        super(QuJingGameTcpHandler, self).doGetCreatTableInfo(userId, gameId, clientId)    @markCmdActionMethod(cmd='game', action="create_table", clientIdVer=0, scope='game', lockParamName="")    def doCreateTable(self, userId, gameId, clientId, roomId0, tableId0, playMode):        super(QuJingGameTcpHandler, self).doCreateTable(userId, gameId, clientId, roomId0, tableId0, playMode)    @markCmdActionMethod(cmd='game', action="join_create_table", clientIdVer=0, scope='game', lockParamName="")    def doJoinCreateTable(self, userId, gameId, clientId, roomId0, tableId0, playMode):        super(QuJingGameTcpHandler, self).doJoinCreateTable(userId, gameId, clientId, roomId0, tableId0, playMode)    @markCmdActionMethod(cmd='game', action="create_table_record", clientIdVer=0, scope='game', lockParamName="")    def doGetCreateTableRecord(self, userId, gameId, clientId):        super(QuJingGameTcpHandler, self).doGetCreateTableRecord(userId, gameId, clientId)    @markCmdActionMethod(cmd='game', action="debug_upload_msg", clientIdVer=0, scope='game', lockParamName="")    def doUploadGameMsgRecord(self, userId, gameId, clientId):        """查询玩家是否在牌桌里        客户端用来判断是否可以走        """        msg = runcmd.getMsgPack()        name = msg.getParam("name")        data = msg.getParam("data")        # hall37/run/client_msg_records        import os        path = "../client_msg_records/"        if False == os.path.exists(path):            os.makedirs(path)        file = open(path + name, 'w')        file.write(data)        file.close()        # tableId, roomId 不为0        message = MsgPack()        message.setCmd('game')        message.setResult('action', "debug_upload_msg")        message.setResult('gameId', 711)        message.setResult('userId', userId)        message.setResult('name', name)        router.sendToUser(message, userId)